# Ontology Extension for nbdev


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Basic Imports

## OntologyGraph

------------------------------------------------------------------------

<a
href="https://github.com/charlesvardeman/nbvoc/blob/master/nbvoc/core.py#L24"
target="_blank" style="float:right; font-size:smaller">source</a>

### OntologyGraph

>  OntologyGraph ()

*Builds and manages the RDF graph for ontology content*

``` python
# Test basic functionality of OntologyGraph
test_graph = OntologyGraph()
test_turtle = """
@prefix ex: <http://example.org/> .
ex:Subject ex:predicate "object" .
"""
test_graph._add_turtle(test_turtle)
test_eq(len(test_graph.graph), 1)
serialized = test_graph.serialize(format="turtle")
test_eq("ex:Subject" in serialized, True)
```

## Ontology Maker

OntologyMaker class that will handle exporting the graph to files

------------------------------------------------------------------------

<a
href="https://github.com/charlesvardeman/nbvoc/blob/master/nbvoc/core.py#L84"
target="_blank" style="float:right; font-size:smaller">source</a>

### OntologyMaker

>  OntologyMaker (dest, name, format='turtle')

*Export ontology graph to various formats*

------------------------------------------------------------------------

<a
href="https://github.com/charlesvardeman/nbvoc/blob/master/nbvoc/core.py#L120"
target="_blank" style="float:right; font-size:smaller">source</a>

### extract_prefixes

>  extract_prefixes (ast)

*Extract prefixes and base URI from a Markdown-ld AST.*

------------------------------------------------------------------------

<a
href="https://github.com/charlesvardeman/nbvoc/blob/master/nbvoc/core.py#L155"
target="_blank" style="float:right; font-size:smaller">source</a>

### extract_triples

>  extract_triples (ast)

*Extract RDF triples from a Markdown-ld AST.*

------------------------------------------------------------------------

<a
href="https://github.com/charlesvardeman/nbvoc/blob/master/nbvoc/core.py#L200"
target="_blank" style="float:right; font-size:smaller">source</a>

### markdown_ld_to_triples

>  markdown_ld_to_triples (markdown_text)

*Convert Markdown-LD text to RDF triples.*

```` python
# Test with Markdown-LD
test_mdld = """
# Test Ontology

```
@prefix ex: <http://example.org/> .
@base <http://example.org/base/> .
```

## TestClass

`ex:TestClass`

```
ex:TestClass a owl:Class .
```

### has property

`ex:hasProperty`

- `"test value"`
"""
````

``` python
test_graph = OntologyGraph()
test_graph._add_markdown_ld(test_mdld)
test_eq(len(test_graph.graph) > 0, True)
```

------------------------------------------------------------------------

<a
href="https://github.com/charlesvardeman/nbvoc/blob/master/nbvoc/core.py#L214"
target="_blank" style="float:right; font-size:smaller">source</a>

### OntologyProcessor

>  OntologyProcessor (nb)

*Process cells with ontology directives*

``` python
# Test OntologyProcessor with a notebook cell
import nbformat
from execnb.nbio import NbCell

# Create a test cell using nbformat first
nb_cell = nbformat.v4.new_code_cell(source="""
@prefix ex: <http://example.org/> .
ex:TestSubject ex:testPredicate "test object" .
""")

# Now create a NbCell with the required arguments
test_cell = NbCell(0, nb_cell)  # idx=0, cell=nb_cell
test_cell.directives_ = {'export_ttl': []}

# Create a processor and process the cell
processor = OntologyProcessor(None)  # nb parameter not used in this test
processor._export_ttl_(test_cell)

# Check if the triple was added to the graph
test_eq(len(processor.graph.graph), 1)
```

``` python
# Test OntologyMaker
import tempfile

with tempfile.TemporaryDirectory() as tmpdir:
    # Create a graph with a test triple
    test_graph = OntologyGraph()
    test_graph._add_turtle("""
    @prefix ex: <http://example.org/> .
    ex:TestSubject ex:testPredicate "test object" .
    """)
    
    # Export the graph
    maker = OntologyMaker(tmpdir, "test_ontology")
    filepath = maker.make(test_graph.graph)  # Note: We pass the RDFLib graph, not the OntologyGraph
    
    # Check that the file was created and contains our triple
    test_eq(Path(filepath).exists(), True)
    with open(filepath, 'r') as f:
        content = f.read()
    test_eq("TestSubject" in content, True)
```

------------------------------------------------------------------------

<a
href="https://github.com/charlesvardeman/nbvoc/blob/master/nbvoc/core.py#L238"
target="_blank" style="float:right; font-size:smaller">source</a>

### process_ontology_notebook

>  process_ontology_notebook (nb_path, output_dir=None, formats=None)

\*Process a notebook and export ontology content to files.

Args: nb_path: Path to the notebook output_dir: Directory to output the
ontology files (defaults to same dir as notebook) formats: List of
output formats (defaults to \[“turtle”\])

Returns: Dictionary mapping formats to output file paths\*

``` python
# Test process_ontology_notebook with the correct string to check
import nbformat
import tempfile
from pathlib import Path

with tempfile.TemporaryDirectory() as tmpdir:
    # Create a test notebook
    nb = nbformat.v4.new_notebook()
    
    # Add a cell with Turtle content
    cell = nbformat.v4.new_code_cell(source="""#| export_ttl
@prefix ex: <http://example.org/> .
ex:TestSubject ex:testPredicate "test object" .
""")
    nb.cells.append(cell)
    
    # Write the notebook to a file
    nb_path = Path(tmpdir) / "test_ontology.ipynb"
    with open(nb_path, 'w') as f:
        nbformat.write(nb, f)
    
    # Process the notebook
    results = process_ontology_notebook(nb_path)
    
    # Check that the output file was created
    test_eq(len(results), 1)
    test_eq("turtle" in results, True)
    test_eq(Path(results["turtle"]).exists(), True)
    
    # Check the content
    with open(results["turtle"], 'r') as f:
        content = f.read()
    
    # Print the content for debugging
    print("File content:")
    print(content)
    
    # Check for the correct string pattern
    test_eq("ex:TestSubject" in content, True)
```

    File content:
    @prefix ex: <http://example.org/> .

    ex:TestSubject ex:testPredicate "test object" .

------------------------------------------------------------------------

<a
href="https://github.com/charlesvardeman/nbvoc/blob/master/nbvoc/core.py#L286"
target="_blank" style="float:right; font-size:smaller">source</a>

### nbvoc_export

>  nbvoc_export (path:str=None, recursive:bool=True, formats:str='turtle',
>                    output_dir:str=None)

*Export ontology content from notebooks*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>str</td>
<td>None</td>
<td>Path to notebook or directory containing notebooks (default: current
dir)</td>
</tr>
<tr>
<td>recursive</td>
<td>bool</td>
<td>True</td>
<td>Search recursively in directories</td>
</tr>
<tr>
<td>formats</td>
<td>str</td>
<td>turtle</td>
<td>Output formats (comma-separated list)</td>
</tr>
<tr>
<td>output_dir</td>
<td>str</td>
<td>None</td>
<td>Output directory (default: ontology_path from settings.ini)</td>
</tr>
</tbody>
</table>

``` python
# Test the CLI function with directory structure preservation
import tempfile
import nbformat
import os
from pathlib import Path
import shutil

with tempfile.TemporaryDirectory() as tmpdir:
    tmp_path = Path(tmpdir)
    
    # Create a directory structure
    notebooks_dir = tmp_path / "notebooks"
    notebooks_dir.mkdir()
    
    subdir1 = notebooks_dir / "module1"
    subdir1.mkdir()
    
    subdir2 = notebooks_dir / "module2" / "submodule"
    subdir2.mkdir(parents=True)
    
    # Create test notebooks in different directories
    nb1 = nbformat.v4.new_notebook()
    cell1 = nbformat.v4.new_code_cell(source="""#| export_ttl
@prefix ex: <http://example.org/> .
ex:Module1 ex:hasProperty "value1" .
""")
    nb1.cells.append(cell1)
    
    nb2 = nbformat.v4.new_notebook()
    cell2 = nbformat.v4.new_code_cell(source="""#| export_ttl
@prefix ex: <http://example.org/> .
ex:Module2 ex:hasProperty "value2" .
""")
    nb2.cells.append(cell2)
    
    # Write notebooks to their respective directories
    nb_path1 = subdir1 / "ontology1.ipynb"
    with open(nb_path1, 'w') as f:
        nbformat.write(nb1, f)
    
    nb_path2 = subdir2 / "ontology2.ipynb"
    with open(nb_path2, 'w') as f:
        nbformat.write(nb2, f)
    
    # Create output directory
    ontology_dir = tmp_path / "ontology"
    
    # Run the export function
    print("\nTesting export with directory structure preservation:")
    current_dir = os.getcwd()
    try:
        # Change to the temp directory to test relative paths
        os.chdir(tmp_path)
        nbvoc_export("notebooks", output_dir="ontology", formats="turtle")
    finally:
        # Change back to original directory
        os.chdir(current_dir)
    
    # Check output directory structure
    expected_files = [
        ontology_dir / "module1" / "ontology1.ttl",
        ontology_dir / "module2" / "submodule" / "ontology2.ttl"
    ]
    
    for file_path in expected_files:
        print(f"Checking if {file_path} exists...")
        test_eq(file_path.exists(), True)
        
        # Verify content
        content = file_path.read_text()
        if "Module1" in content:
            test_eq("ex:Module1" in content, True)
        elif "Module2" in content:
            test_eq("ex:Module2" in content, True)
    
    print("Directory structure test passed!")
```


    Testing export with directory structure preservation:
    Exported ontology2.ipynb to: ontology/module2/submodule/ontology2.ttl
    Exported ontology1.ipynb to: ontology/module1/ontology1.ttl
    Checking if /tmp/tmpaizneeos/ontology/module1/ontology1.ttl exists...
    Checking if /tmp/tmpaizneeos/ontology/module2/submodule/ontology2.ttl exists...
    Directory structure test passed!

``` python
# Test the CLI function with directory structure preservation
import tempfile
import nbformat
import os
from pathlib import Path
import shutil

with tempfile.TemporaryDirectory() as tmpdir:
    tmp_path = Path(tmpdir)
    
    # Create a directory structure
    notebooks_dir = tmp_path / "notebooks"
    notebooks_dir.mkdir()
    
    subdir1 = notebooks_dir / "module1"
    subdir1.mkdir()
    
    subdir2 = notebooks_dir / "module2" / "submodule"
    subdir2.mkdir(parents=True)
    
    # Create test notebooks in different directories
    nb1 = nbformat.v4.new_notebook()
    cell1 = nbformat.v4.new_code_cell(source="""#| export_ttl
@prefix ex: <http://example.org/> .
ex:Module1 ex:hasProperty "value1" .
""")
    nb1.cells.append(cell1)
    
    nb2 = nbformat.v4.new_notebook()
    cell2 = nbformat.v4.new_code_cell(source="""#| export_ttl
@prefix ex: <http://example.org/> .
ex:Module2 ex:hasProperty "value2" .
""")
    nb2.cells.append(cell2)
    
    # Write notebooks to their respective directories
    nb_path1 = subdir1 / "ontology1.ipynb"
    with open(nb_path1, 'w') as f:
        nbformat.write(nb1, f)
    
    nb_path2 = subdir2 / "ontology2.ipynb"
    with open(nb_path2, 'w') as f:
        nbformat.write(nb2, f)
    
    # Create output directory
    ontology_dir = tmp_path / "ontology"
    
    # Run the export function
    print("\nTesting export with directory structure preservation:")
    current_dir = os.getcwd()
    try:
        # Change to the temp directory to test relative paths
        os.chdir(tmp_path)
        nbvoc_export("notebooks", output_dir="ontology", formats="turtle")
    finally:
        # Change back to original directory
        os.chdir(current_dir)
    
    # Check output directory structure - updated paths
    expected_files = [
        ontology_dir / "module1" / "ontology1.ttl",
        ontology_dir / "module2" / "submodule" / "ontology2.ttl"
    ]
    
    for file_path in expected_files:
        print(f"Checking if {file_path} exists...")
        test_eq(file_path.exists(), True)
        
        # Verify content
        content = file_path.read_text()
        if "Module1" in str(file_path):
            test_eq("ex:Module1" in content, True)
        elif "Module2" in str(file_path):
            test_eq("ex:Module2" in content, True)
    
    print("Directory structure test passed!")
```


    Testing export with directory structure preservation:
    Exported ontology2.ipynb to: ontology/module2/submodule/ontology2.ttl
    Exported ontology1.ipynb to: ontology/module1/ontology1.ttl
    Checking if /tmp/tmpvyd10q7n/ontology/module1/ontology1.ttl exists...
    Checking if /tmp/tmpvyd10q7n/ontology/module2/submodule/ontology2.ttl exists...
    Directory structure test passed!
